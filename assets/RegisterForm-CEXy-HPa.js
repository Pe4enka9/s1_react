import{r as e,j as n}from"./date-DgmWt_b0.js";import{p as V}from"./profile-CE0EU4nc.js";import{S as C,I as f,P as W,B as q}from"./BaseForm-Iqju4LCa.js";import{a as A}from"./forms-Bcu1OiOT.js";import{g as d}from"./getFirstError-BclANIRF.js";import"./vendor-gH-7aFTg.js";function $({isActive:k,setIsActive:_,setNotification:u}){const[r,x]=e.useState({phone_number:"",first_name:"",last_name:"",password:"",password_confirmation:""}),[a,w]=e.useState({}),[l,E]=e.useState({password_register:!0,password_confirmation:!0}),[s,i]=e.useState(0),[P,H]=e.useState(!0),[N,I]=e.useState(!1),[F,h]=e.useState(!1),[M,m]=e.useState(null),[B,p]=e.useState("next"),[L,D]=e.useState(!1),K=e.useRef(null),g=e.useRef(null),b=e.useRef(null),S=e.useRef(null),R=e.useRef(null),v=e.useRef(null),y=e.useRef(null),c=e.useCallback(t=>{const{name:o,value:T}=t.target;x({...r,[o]:T}),w({...a,[o]:""})},[a,r]),O=e.useCallback(()=>{let t=!1;return s===1?t=r.phone_number.length!==18:s===2?t=!r.first_name.trim()||!r.last_name.trim():s===3&&(t=!r.password.trim()),t},[s,r.first_name,r.last_name,r.password,r.phone_number.length]),z=e.useCallback(async()=>{try{R.current?.blur(),I(!0),w({}),h(!1);const t=await A.post("http://127.0.0.1:8000/api/register",r);t.status===201&&(D(!1),u({text:"Вы зарегистрировались!",failed:!1,active:!0}),setTimeout(()=>u(o=>({...o,active:!1})),2e3),v.current=setTimeout(()=>{i(0),x({phone_number:"",first_name:"",last_name:"",password:"",password_confirmation:""}),_(!1)},1200),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.user)),window.dispatchEvent(new Event("storage")))}catch(t){u({text:"Не удалось зарегистрироваться",failed:!0,active:!0}),setTimeout(()=>u(T=>({...T,active:!1})),2e3),t.code==="ERR_NETWORK"&&(h(!0),y.current=setTimeout(()=>h(!1),2e3));const o=t.response.data.errors;w(o),o.password&&s!==3?(m(s),p("next"),i(3),setTimeout(()=>S.current?.focus(),800)):o.first_name&&s!==2?(m(s),p("prev"),i(2),setTimeout(()=>g.current?.focus(),800)):o.last_name&&s!==2?(m(s),p("prev"),i(2),setTimeout(()=>b.current?.focus(),800)):o.phone_number&&s!==1&&(m(s),p("prev"),i(1),setTimeout(()=>K.current?.focus(),800))}finally{I(!1)}},[s,r,_,u]),j=e.useCallback(t=>{t.key==="Enter"&&(t.preventDefault(),s===2&&t.target.id==="first_name"?b.current?.focus():s===3&&t.target.id==="password"&&R.current?.focus())},[s]),J=e.useMemo(()=>[n.jsx(C,{children:n.jsx(f,{id:"phone_number",label:"Номер телефона",error:d(a.phone_number),children:n.jsx(W,{formData:r,setFormData:x,errors:a,setErrors:w,inputRef:K})})},"step-1"),n.jsxs(C,{children:[n.jsx(f,{id:"first_name",label:"Имя",error:d(a.first_name),children:n.jsx("input",{type:"text",inputMode:"text",name:"first_name",id:"first_name",className:a.first_name?"error-input":"",placeholder:"Введите ваше имя",autoComplete:"given-name",value:r.first_name,onChange:c,onKeyDown:j,enterKeyHint:"next",ref:g})}),n.jsx(f,{id:"last_name",label:"Фамилия",error:d(a.last_name),children:n.jsx("input",{type:"text",inputMode:"text",name:"last_name",id:"last_name",className:a.last_name?"error-input":"",placeholder:"Введите вашу фамилию",autoComplete:"family-name",value:r.last_name,onChange:c,enterKeyHint:"next",ref:b})})]},"step-2"),n.jsxs(C,{children:[n.jsx(f,{id:"password",label:"Пароль",error:d(a.password),isPasswordHidden:l,setIsPasswordHidden:E,isPassword:!0,children:n.jsx("input",{type:l.password_register?"password":"text",inputMode:"text",name:"password",id:"password",className:a.password?"error-input":"",placeholder:"Введите пароль",autoComplete:"new-password",value:r.password,onChange:c,onKeyDown:j,enterKeyHint:"next",ref:S})}),n.jsx(f,{id:"password_confirmation",label:"Повтор пароля",error:d(a.password_confirmation),isPasswordHidden:l,setIsPasswordHidden:E,isPassword:!0,children:n.jsx("input",{type:l.password_confirmation?"password":"text",inputMode:"text",name:"password_confirmation",id:"password_confirmation",className:a.password_confirmation?"error-input":"",placeholder:"Повторите пароль",autoComplete:"new-password",value:r.password_confirmation,onChange:c,enterKeyHint:"done",ref:R})})]},"step-3")],[a,r,c,j,l]);return e.useEffect(()=>()=>{v.current&&clearTimeout(v.current),y.current&&clearTimeout(y.current)},[]),e.useEffect(()=>{let t=null;return s===2?t=setTimeout(()=>g.current?.focus(),800):s===3&&(t=setTimeout(()=>S.current?.focus(),800)),()=>{t&&clearTimeout(t)}},[s]),n.jsx(q,{isActive:k,setIsActive:_,currentStep:s,setCurrentStep:i,steps:J,isDisabledButton:P,setIsDisabledButton:H,isServerError:F,isLoading:N,direction:B,setDirection:p,prevStep:M,setPrevStep:m,isAnimating:L,setIsAnimating:D,id:"register",failedValidation:O,icon:n.jsx("img",{src:V,alt:"Создание аккаунта",loading:"lazy"}),title:"Создание аккаунта",buttonText:"Зарегистрироваться",progressLabels:["Контакт","Личные данные","Пароль"],onSubmit:z})}export{$ as default};
