import{r as e,j as n}from"./date-DgmWt_b0.js";import{p as M}from"./profile-CE0EU4nc.js";import{S as v,I as j,P as O,B as z}from"./BaseForm-Iqju4LCa.js";import{a as J}from"./forms-Bcu1OiOT.js";import"./vendor-gH-7aFTg.js";function G({isActive:I,setIsActive:p,setNotification:u}){const[s,d]=e.useState({phone_number:"",password:""}),[o,i]=e.useState({}),[f,_]=e.useState(!0),[r,l]=e.useState(0),[y,C]=e.useState(!0),[D,g]=e.useState(!1),[P,m]=e.useState(!1),[k,h]=e.useState(null),[B,w]=e.useState("next"),[F,T]=e.useState(!1),R=e.useRef(null),c=e.useRef(null),S=e.useRef(null),b=e.useRef(null),E=e.useCallback(t=>{const{name:a,value:x}=t.target;d({...s,[a]:x}),i({...o,[a]:""})},[o,s]),L=e.useCallback(()=>{let t=!1;return r===1?t=s.phone_number.length!==18:r===2&&(t=!s.password.trim()),t},[r,s.password,s.phone_number.length]),H=e.useCallback(async()=>{try{c.current?.blur(),g(!0),i({}),m(!1);const t=await J.post("http://127.0.0.1:8000/api/login",s);t.status===200&&(u({text:"Вы вошли!",failed:!1,active:!0}),setTimeout(()=>u(a=>({...a,active:!1})),2e3),T(!1),S.current=setTimeout(()=>{l(0),d({phone_number:"",password:""}),p(!1)},1200),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.user)),window.dispatchEvent(new Event("storage")))}catch(t){if(u({text:"Не удалось войти",failed:!0,active:!0}),setTimeout(()=>u(x=>({...x,active:!1})),2e3),t.code==="ERR_NETWORK")m(!0),b.current=setTimeout(()=>m(!1),2e3);else if(t.status===401){i({password:"Неверный логин или пароль"});return}const a=t.response.data.errors;i(a),a.password&&r!==2?(h(r),w("next"),l(2),setTimeout(()=>c.current?.focus(),800)):a.phone_number&&r!==1&&(h(r),w("prev"),l(1),setTimeout(()=>R.current?.focus(),800))}finally{g(!1)}},[r,s,p,u]),K=e.useMemo(()=>[n.jsx(v,{children:n.jsx(j,{id:"phone_number",label:"Номер телефона",error:o.phone_number,children:n.jsx(O,{formData:s,setFormData:d,errors:o,setErrors:i,inputRef:R})})},"step-1"),n.jsx(v,{children:n.jsx(j,{id:"password",label:"Пароль",error:o.password,isPasswordHidden:f,setIsPasswordHidden:_,isPassword:!0,children:n.jsx("input",{type:f?"password":"text",inputMode:"text",name:"password",id:"password",className:o.password?"error-input":"",placeholder:"Введите пароль",autoComplete:"new-password",value:s.password,onChange:E,enterKeyHint:"done",ref:c})})},"step-2")],[o,s,E,f]);return e.useEffect(()=>()=>{S.current&&clearTimeout(S.current),b.current&&clearTimeout(b.current)},[]),e.useEffect(()=>{let t=null;return r===2&&(t=setTimeout(()=>c.current?.focus(),800)),()=>{t&&clearTimeout(t)}},[r]),n.jsx(z,{isActive:I,setIsActive:p,currentStep:r,setCurrentStep:l,steps:K,isDisabledButton:y,setIsDisabledButton:C,isServerError:P,isLoading:D,direction:B,setDirection:w,prevStep:k,setPrevStep:h,isAnimating:F,setIsAnimating:T,id:"login",failedValidation:L,icon:n.jsx("img",{src:M,alt:"Вход в аккаунт",loading:"lazy"}),title:"Вход в аккаунт",buttonText:"Войти",progressLabels:["Контакт","Пароль"],onSubmit:H})}export{G as default};
